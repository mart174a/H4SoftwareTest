@page "/"
@using H4SoftwareTest.Models
@using Newtonsoft.Json;

@attribute [Microsoft.AspNetCore.Authorization.Authorize(Policy = "AuthenticatedUser")]
@inject AuthenticationStateProvider _authenticationStateProvider;
@inject Codes.RoleHandler _roleHandler;
@inject IServiceProvider _serviceProvider;

@inject Codes.HashingHandler _hashingHandler;
@inject Codes.EncryptionHandler _encryptionHandler;
@inject HttpClient _httpClient;
@inject Models.TodoContext _toDoContext;

<PageTitle>Home</PageTitle>

@if (_cpr == null)
{
    <div style="margin:0 auto;">
        <div style="font-weight:bold;">Indtast dit cpr-nr:</div>
        <input type="text" @bind="_cprInput" style="width:150px;" />
        <br />
        <button class="btn-primary" @onclick="SubmitCpr" style="width:150px;height:45px;margin-top:4px;">Submit</button>
    </div>
}
else
{
    <div style="margin:0 auto;">
        <div style="font-weight:bold;margin-top:20px;">Indtast to-do item:</div>
        <input type="text" @bind="_todoItemInput" style="width:150px;" />
        <br />
        <button class="btn-primary" @onclick="AddTodoItem" style="width:150px;height:45px;margin-top:4px;">Submit</button>
    </div>

    <div style="margin-top:18px;">
        @if (TodoListObj != null && TodoListObj.Count > 0)
        {
            <table class="table">
                <thead>
                    <tr>
                        <th>My to do items</th>
                    </tr>
                </thead>
                <tbody>
                    @if (TodoListObj != null && TodoListObj.Count > 0)
                    {
                        @foreach (var item in TodoListObj)
                        {
                            <tr>
                                @* <td>@_asymetriskEncryptionHandler.DecryptAsymetrisk(@item.Item)</td> *@
                                <td>@item.Item</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
            <div>
                @if (_isAdmin)
                {
                    <button class="btn-primary" @onclick="ClearItems" style="width:150px;height:45px;margin-top:4px;">Clear todo list</button>
                }
            </div>
        }
    </div>
}


<br />

@code {
    private bool _isAuthenticated;
    private bool _isAdmin;
    private string? _userName;
    private string? _cpr;
    private string? _cprInput;
    private string? _todoItemInput;

    private List<Todolist>? TodoListObj;

    protected override async Task OnInitializedAsync()
    {
        var authState = await _authenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        _isAuthenticated = user.Identity.IsAuthenticated;
        _isAdmin = user.IsInRole("Admin");

        _userName = user.Identity.Name;
    }

    private void SubmitCpr()
    {
        
    }

    private void AddTodoItem()
    {

    }

    private void ClearItems()
    {

    }
}